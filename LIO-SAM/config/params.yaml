lio_sam:
  # Topics
  pointCloudTopic: "/velodyne_points" # 修改正确: 对应 Gazebo 里的雷达话题
  imuTopic: "/imu/data"               # 修改正确: 必须加斜杠，对应 Gazebo 里的 IMU 话题
  odomTopic: "odometry/imu" 
  gpsTopic: "odometry/gpsz" 

  # Frames
  lidarFrame: "velodyne"
  baselinkFrame: "base_link"
  odometryFrame: "odom"
  mapFrame: "map"

  # GPS Settings
  useImuHeadingInitialization: false # 修改: 室内环境建议关掉，依赖 IMU 自身积分
  useGpsElevation: false 
  gpsCovThreshold: 2.0 
  poseCovThreshold: 25.0 

  # Export settings
  savePCD: false 
  savePCDDirectory: "/Downloads/LOAM/" 

  # Sensor Settings
  sensor: velodyne 
  N_SCAN: 16 
  Horizon_SCAN: 1800 
  downsampleRate: 1 
  lidarMinRange: 0.3    # 修改: 仓库环境狭窄，改小一点以免漏掉近处货架
  lidarMaxRange: 1000.0 

  # IMU Settings
  # 修改版：增大噪声容忍度，消除仿真抖动
  imuAccNoise: 0.1         # 原来是 0.003... 改大到 0.1
  imuGyrNoise: 0.1         # 原来是 0.001... 改大到 0.1
  imuAccBiasN: 0.001       # 改大
  imuGyrBiasN: 0.001       # 改大
  imuGravity: 9.80511
  imuRPYWeight: 0.01

  # Extrinsics: T_lb (lidar -> imu)
  # !!! 核心修改 !!! 
  # 仿真里通常雷达和IMU方向一致，必须用单位矩阵，否则地图会乱飞
  extrinsicTrans: [0.0, 0.0, 0.0]
  extrinsicRot: [1, 0, 0,
                  0, 1, 0,
                  0, 0, 1]
  extrinsicRPY: [1, 0, 0,
                  0, 1, 0,
                  0, 0, 1]

  # LOAM feature threshold
  edgeThreshold: 1.0
  surfThreshold: 0.1
  edgeFeatureMinValidNum: 10
  surfFeatureMinValidNum: 100

  # voxel filter paprams
  odometrySurfLeafSize: 0.2  # 修改: 室内建议改小一点(0.2)，提高精度
  mappingCornerLeafSize: 0.1 # 修改: 室内建议改小一点(0.1)
  mappingSurfLeafSize: 0.2   # 修改: 室内建议改小一点(0.2)

  # robot motion constraint (in case you are using a 2D robot)
  z_tollerance: 1000 
  rotation_tollerance: 1000 

  # CPU Params
  numberOfCores: 4 
  mappingProcessInterval: 0.15 

  # Surrounding map
  surroundingkeyframeAddingDistThreshold: 1.0 
  surroundingkeyframeAddingAngleThreshold: 0.2 
  surroundingKeyframeDensity: 2.0 
  surroundingKeyframeSearchRadius: 50.0 

  # Loop closure
  loopClosureEnableFlag: false
  loopClosureFrequency: 1.0 
  surroundingKeyframeSize: 50 
  historyKeyframeSearchRadius: 15.0 
  historyKeyframeSearchTimeDiff: 30.0 
  historyKeyframeSearchNum: 25 
  historyKeyframeFitnessScore: 0.3 

  # Visualization
  globalMapVisualizationSearchRadius: 1000.0 
  globalMapVisualizationPoseDensity: 10.0 
  globalMapVisualizationLeafSize: 1.0 

# Navsat (convert GPS coordinates to Cartesian)
navsat:
  frequency: 50
  wait_for_datum: false
  delay: 0.0
  magnetic_declination_radians: 0
  yaw_offset: 0
  zero_altitude: true
  broadcast_utm_transform: false
  broadcast_utm_transform_as_parent_frame: false
  publish_filtered_gps: false

# EKF for Navsat
ekf_gps:
  publish_tf: false
  map_frame: map
  odom_frame: odom
  base_link_frame: base_link
  world_frame: odom

  frequency: 50
  two_d_mode: false
  sensor_timeout: 0.01
  # -------------------------------------
  # External IMU:
  # -------------------------------------
  imu0: imu_correct
  imu0_config:
    [
      false, false, false,
      true,  true,  true,
      false, false, false,
      false, false, true,
      true,  true,  true,
    ]
  imu0_differential: false
  imu0_queue_size: 50
  imu0_remove_gravitational_acceleration: true
  # -------------------------------------
  # Odometry (From Navsat):
  # -------------------------------------
  odom0: odometry/gps
  odom0_config:
    [
      true,  true,  true,
      false, false, false,
      false, false, false,
      false, false, false,
      false, false, false,
    ]
  odom0_differential: false
  odom0_queue_size: 10

  process_noise_covariance:
    [
      1.0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 1.0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 10.0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0.03, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0.03, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0.1, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0.25, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0.25, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0.04, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0.01, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.01, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.5, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.01, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.01, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.015,
    ]